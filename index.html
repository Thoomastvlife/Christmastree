<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è–èª•å¿«æ¨‚ - èºæ—‹è–èª•æ¨¹</title>
    <style>
        /* å…¨å±€é‡ç½®+æ‰‹æ©Ÿé©é… */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background-color: #000;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            perspective: 800px;
            font-family: 'Microsoft JhengHei', sans-serif;
            touch-action: manipulation;
            opacity: 0;
            animation: fadeIn 1s ease forwards;
            transform: translateZ(0);
            /* æ‰‹æ©Ÿç«¯é—œé–‰å½ˆæ€§æ»¾å‹•ï¼Œé¿å…å¹²æ“¾å‹•ç•« */
            overscroll-behavior: none;
        }

        /* éŸ³æ¨‚æŒ‰éˆ• */
        #music-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: #fff;
            border: 2px solid #FFD700;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: clamp(12px, 2vw, 14px);
            z-index: 999;
            transition: all 0.3s ease;
        }
        #music-btn:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        /* è–èª•æ¨¹å®¹å™¨ */
        .tree-container {
            position: relative;
            width: clamp(200px, 50vw, 300px);
            height: clamp(250px, 60vw, 350px);
            transform-style: preserve-3d;
            transform-origin: center center;
            transform: translateZ(0);
            will-change: transform;
            backface-visibility: hidden;
            animation: rotateTree 25s infinite linear;
            margin: 20px 0;
        }

        @keyframes rotateTree {
            0% { transform: rotateY(0deg) translateZ(0); }
            100% { transform: rotateY(360deg) translateZ(0); }
        }

        /* èºæ—‹å…‰å¸¶ */
        .dot {
            position: absolute;
            width: clamp(4px, 1vw, 6px);
            height: clamp(4px, 1vw, 6px);
            border-radius: 50%;
            box-shadow: 0 0 clamp(5px, 1.5vw, 7px) clamp(1px, 0.3vw, 1.5px) currentColor;
            opacity: 0.95;
            left: 50%;
            top: 0;
            transform: translateX(-50%) translateZ(0);
            will-change: transform;
            backface-visibility: hidden;
            transition: none;
        }

        /* æ¨¹é ‚æ˜Ÿæ˜Ÿ */
        .star {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%) rotateY(0deg) translateZ(0);
            color: #FFD700;
            font-size: clamp(24px, 5vw, 30px);
            text-shadow: 0 0 clamp(8px, 2vw, 10px) #FFD700;
            z-index: 10;
            animation: twinkle 2s infinite alternate;
            will-change: opacity, text-shadow;
        }

        @keyframes twinkle {
            from { opacity: 0.8; }
            to { opacity: 1; text-shadow: 0 0 15px #FFD700; }
        }

        /* æ–‡å­—å€åŸŸ */
        .message {
            text-align: center;
            margin-top: 10px;
            pointer-events: none;
            z-index: 10;
        }
        .message h1 {
            font-size: clamp(1.5em, 5vw, 2em);
            color: #FF4D4D;
            text-shadow: 0 0 clamp(6px, 2vw, 8px) #FF4D4D;
            margin-bottom: 5px;
            animation: pulse 3s infinite alternate;
        }
        .message p {
            font-size: clamp(0.8em, 3vw, 1em);
            color: #fff;
            text-shadow: 0 0 clamp(4px, 1.5vw, 6px) #fff;
            letter-spacing: 1px;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }

        /* é›ªèŠ±æ•ˆæœ - æ‰‹æ©Ÿç«¯æ ¸å¿ƒä¿®å¾© */
        .snow {
            position: absolute;
            top: -10px;
            color: #fff;
            font-size: clamp(10px, 2vw, 12px);
            opacity: 0.7;
            pointer-events: none;
            /* 1. ç§»é™¤å¤šå‹•ç•«ç–ŠåŠ ï¼Œæ”¹ç”¨å–®ä¸€è¤‡åˆå‹•ç•« */
            animation: snowFall 6s linear forwards;
            /* 2. æ‰‹æ©Ÿç«¯å¼·åˆ¶ç¡¬ä»¶åŠ é€Ÿ */
            transform: translateZ(0);
            will-change: transform, opacity;
            /* 3. æå‡z-indexï¼Œé¿å…è¢«é®æ“‹ */
            z-index: 1;
        }

        /* ä¿®å¾©æ‰‹æ©Ÿç«¯é›ªèŠ±ä¸‹è½å‹•ç•« - æ›¿æ›vhç‚ºå›ºå®šå€¼+è¢å¹•é«˜åº¦é©é… */
        @keyframes snowFall {
            0% { 
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 0.7;
            }
            90% {
                opacity: 0.5;
            }
            100% { 
                /* ç”¨100%æ›¿ä»£110vhï¼Œè§£æ±ºæ‰‹æ©Ÿvhè§£æå•é¡Œ */
                transform: translateY(100vh) translateX(10px) rotate(10deg);
                opacity: 0;
            }
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- éŸ³æ¨‚æ§åˆ¶ -->
    <button id="music-btn">ğŸ”‡ æ’­æ”¾éŸ³æ¨‚</button>
    <audio id="bg-music" loop preload="auto">
        <source src="tree.mp3" type="audio/mpeg">
        ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´éŸ³é »æ’­æ”¾
    </audio>

    <!-- è–èª•æ¨¹ -->
    <div class="tree-container" id="tree">
        <div class="star">â˜…</div>
    </div>

    <!-- æ–‡å­— -->
    <div class="message">
        <h1>Merry Christmas</h1>
        <p>ç¥ä½ è–èª•å¿«æ¨‚ï¼Œå¹¸ç¦æ°¸é </p>
    </div>

    <script>
        // éŸ³æ¨‚æ§åˆ¶ï¼ˆä¿ç•™ï¼‰
        const audio = document.getElementById('bg-music');
        const musicBtn = document.getElementById('music-btn');
        let isMusicOn = false;
        let musicInitiated = false;
        audio.volume = 0.4;

        function playMusic() {
            if (musicInitiated) return;
            musicInitiated = true;
            
            audio.play().then(() => {
                isMusicOn = true;
                musicBtn.textContent = "ğŸ”Š é—œé–‰éŸ³æ¨‚";
            }).catch((err) => {
                console.log("éŸ³é »æ’­æ”¾æç¤ºï¼š", err);
                musicBtn.textContent = "ğŸ”‡ é»æ“Šæ‰‹å‹•æ’­æ”¾";
                musicInitiated = false;
            });
        }

        document.addEventListener('click', initMusic);
        document.addEventListener('touchstart', initMusic);

        function initMusic() {
            if (!isMusicOn && !musicInitiated) {
                playMusic();
            }
        }

        musicBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (isMusicOn) {
                audio.pause();
                isMusicOn = false;
                musicBtn.textContent = "ğŸ”‡ æ’­æ”¾éŸ³æ¨‚";
            } else {
                playMusic();
            }
        });

        // ç”Ÿæˆèºæ—‹è–èª•æ¨¹ï¼ˆä¿ç•™ï¼‰
        const tree = document.getElementById('tree');
        const dotCount = 220;
        const colors = ['#FF4D4D', '#00FF00', '#FFFFFF', '#FFD700', '#00BFFF'];

        for (let i = 0; i < dotCount; i++) {
            const dot = document.createElement('div');
            dot.className = 'dot';
            
            const progress = i / dotCount;
            const height = progress * 380;
            const radius = progress * 120;
            const angle = i * 0.28;
            
            const x = Math.cos(angle) * radius;
            const z = Math.sin(angle) * radius;
            
            const colorIndex = Math.floor((i / dotCount) * colors.length);
            dot.style.color = colors[colorIndex % colors.length];
            dot.style.background = dot.style.color;
            
            dot.style.transform = `translate3d(${x.toFixed(2)}px, ${height.toFixed(2)}px, ${z.toFixed(2)}px)`;
            
            tree.appendChild(dot);
        }

        // é›ªèŠ±ç”Ÿæˆ - æ‰‹æ©Ÿç«¯æ€§èƒ½å„ªåŒ–
        let snowTimer = null;
        // æ‰‹æ©Ÿç«¯æ¸›å°‘é›ªèŠ±æ•¸é‡å’Œç”Ÿæˆé »ç‡
        const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        const MAX_SNOW = isMobile ? 30 : 50; // æ‰‹æ©Ÿæœ€å¤š30å€‹é›ªèŠ±
        const SNOW_INTERVAL = isMobile ? 500 : 300; // æ‰‹æ©Ÿæ¯500msç”Ÿæˆä¸€å€‹

        function createSnow() {
            // 1. åš´æ ¼é™åˆ¶é›ªèŠ±æ•¸é‡ï¼Œé¿å…GPUè¶…è¼‰
            const snowCount = document.querySelectorAll('.snow').length;
            if (snowCount >= MAX_SNOW) return;
            
            const snow = document.createElement('div');
            snow.className = 'snow';
            snow.textContent = ['â„', 'â…', 'â†'][Math.floor(Math.random() * 3)];
            
            // 2. å„ªåŒ–é›ªèŠ±ä½ç½®è¨ˆç®—ï¼Œé¿å…è¶…å‡ºè¢å¹•
            const screenWidth = window.innerWidth;
            snow.style.left = Math.min(Math.random() * screenWidth, screenWidth - 20) + 'px';
            
            // 3. æ‰‹æ©Ÿç«¯éš¨æ©Ÿå‹•ç•«æ™‚é•·ï¼Œé¿å…åŒæ­¥å¡é “
            const duration = isMobile ? (Math.random() * 3 + 4) : (Math.random() * 4 + 3);
            snow.style.animationDuration = `${duration}s`;
            
            snow.style.opacity = Math.random() * 0.5 + 0.3;
            
            document.body.appendChild(snow);
            
            // 4. åŠæ™‚æ¸…ç†é›ªèŠ±ï¼Œé¿å…è¨˜æ†¶é«”æ´©æ¼
            setTimeout(() => {
                if (snow && snow.parentNode) {
                    snow.remove();
                }
            }, duration * 1000 + 100);
        }

        // 5. æ‰‹æ©Ÿç«¯ä½¿ç”¨requestAnimationFrameå„ªåŒ–å®šæ™‚å™¨
        function snowLoop() {
            createSnow();
            snowTimer = setTimeout(() => {
                requestAnimationFrame(snowLoop);
            }, SNOW_INTERVAL);
        }

        // å•Ÿå‹•é›ªèŠ±ç”Ÿæˆï¼ˆé é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œï¼‰
        window.addEventListener('load', () => {
            snowLoop();
        });

        // 6. é é¢éš±è—æ™‚åœæ­¢é›ªèŠ±ç”Ÿæˆï¼Œæ¸›å°‘è€—é›»
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                clearTimeout(snowTimer);
            } else {
                snowLoop();
            }
        });

        // è¦–çª—å¤§å°è®ŠåŒ–å„ªåŒ–
        window.addEventListener('resize', () => {
            tree.style.willChange = 'auto';
            setTimeout(() => {
                tree.style.willChange = 'transform';
            }, 100);
        });

        // é é¢ç„¦é»å„ªåŒ–
        window.addEventListener('blur', () => {
            if (isMusicOn) audio.pause();
            tree.style.animationDuration = '60s';
            clearTimeout(snowTimer); // åœæ­¢é›ªèŠ±ç”Ÿæˆ
        });

        window.addEventListener('focus', () => {
            if (isMusicOn) {
                musicBtn.textContent = "ğŸ”‡ é»æ“Šæ¢å¾©éŸ³æ¨‚";
                isMusicOn = false;
            }
            tree.style.animationDuration = '25s';
            snowLoop(); // æ¢å¾©é›ªèŠ±ç”Ÿæˆ
        });
    </script>
</body>
</html>
